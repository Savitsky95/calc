<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор виконання плану ТО</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Добавляем стили для модального окна и кнопок */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
        }

        .modal-content {
            background-color: #fefefe; 
            margin: 15% auto; 
            padding: 20px; 
            border: 1px solid #888; 
            width: 80%; 
        }

        .close {
            color: #aaa; 
            float: right; 
            font-size: 28px; 
            font-weight: bold; 
        }

        .close:hover,
        .close:focus {
            color: black; 
            text-decoration: none; 
            cursor: pointer; 
        }

        .share-buttons {
            margin-top: 20px;
        }

        .share-btn {
            display: inline-block; 
            margin: 5px; 
            padding: 10px; 
            text-decoration: none; 
            color: white; 
            border-radius: 5px; 
            font-weight: bold; 
        }

        .viber {
            background-color: #6e3b9a;
        }

        .telegram {
            background-color: #0088cc;
        }

        .whatsapp {
            background-color: #25D366;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="allbody">
            <h1>Калькулятор виконання плану ТО</h1>
            <label for="plan">Введіть план (грн):</label>
            <input type="number" id="plan" placeholder="План" />
            <label for="fact">Введіть факт (грн):</label>
            <input type="number" id="fact" placeholder="Факт" />
            <button onclick="calculateTO()" class="interactive">Розрахувати</button>
            
            <!-- Кнопка перехода ко второй странице -->
            <button onclick="window.location.href='vtm_calculator.html'" class="interactive">Перейти на калькулятор ВТМ</button>
        </div>
    </div>

    <!-- Модальное окно для отображения результатов -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Результати:</h3>
            <p id="modalResult100"></p>
            <p id="modalResult95"></p>
            <p id="modalDaysWithToday"></p>
            <p id="modalDaysWithoutToday"></p>
            <p id="modalCurrentPercentage"></p>

            <!-- Кнопки поделиться -->
            <div class="share-buttons">
                <a id="share-viber" class="share-btn viber" href="#" target="_blank">Поділитися через Viber</a>
                <a id="share-telegram" class="share-btn telegram" href="#" target="_blank">Поділитися через Telegram</a>
                <a id="share-whatsapp" class="share-btn whatsapp" href="#" target="_blank">Поділитися через WhatsApp</a>
            </div>
        </div>
    </div>

    <script>
        function safeDivide(numerator, denominator) {
            return denominator === 0 ? 0 : (numerator / denominator).toFixed(2);
        }

        function calculateTO() {
            const plan = parseFloat(document.getElementById('plan').value);
            const fact = parseFloat(document.getElementById('fact').value);

            if (isNaN(plan) || isNaN(fact)) {
                alert("Будь ласка, введіть правильне число");
                return;
            }

            const remaining100 = plan - fact;
            const remaining95 = (plan * 0.95) - fact;

            const today = new Date();
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const daysLeftIncludingToday = daysInMonth - today.getDate() + 1;
            const daysLeftExcludingToday = daysInMonth - today.getDate();

            const currentPercentage = plan === 0 ? 0 : ((fact / plan) * 100).toFixed(2);

            const resultText = `Результати виконання плану товарообігу:\n` +
                `Залишилось до 100%: ${remaining100.toFixed(2)} грн.\n` +
                `Залишилось до 95%: ${remaining95.toFixed(2)} грн.\n` +
                `Сума на день (з урахуванням сьогоднішнього дня):\n` +
                `95% - ${safeDivide(remaining95, daysLeftIncludingToday)} грн.\n` +
                `100% - ${safeDivide(remaining100, daysLeftIncludingToday)} грн.\n` +
                `Сума на день (без урахування сьогоднішнього дня):\n` +
                `95% - ${safeDivide(remaining95, daysLeftExcludingToday)} грн.\n` +
                `100% - ${safeDivide(remaining100, daysLeftExcludingToday)} грн.\n` +
                `Виконання плану: ${currentPercentage}%`;

            document.getElementById('modalResult100').textContent = `Залишилось до 100%: ${remaining100.toFixed(2)} грн.`;
            document.getElementById('modalResult95').textContent = `Залишилось до 95%: ${remaining95.toFixed(2)} грн.`;
            document.getElementById('modalDaysWithToday').textContent = `Сума на день з урахуванням сьогодняшнього дня (95%): ${safeDivide(remaining95, daysLeftIncludingToday)} грн. / 100%: ${safeDivide(remaining100, daysLeftIncludingToday)} грн.`;
            document.getElementById('modalDaysWithoutToday').textContent = `Сума на день без урахування сьогодняшнього дня (95%): ${safeDivide(remaining95, daysLeftExcludingToday)} грн. / 100%: ${safeDivide(remaining100, daysLeftExcludingToday)} грн.`;
            document.getElementById('modalCurrentPercentage').textContent = `Виконання плану: ${currentPercentage}%`;

            // Укоротить текст для Viber
            const shortResultText = resultText.substring(0, 1000); // Укоротить до 1000 символов

            document.getElementById('share-viber').href = `viber://forward?text=${encodeURIComponent(shortResultText)}`;
            document.getElementById('share-telegram').href = `https://t.me/share/url?url=${encodeURIComponent(resultText)}`;
            document.getElementById('share-whatsapp').href = `https://api.whatsapp.com/send?text=${encodeURIComponent(resultText)}`;

            document.getElementById('resultModal').style.display = "block";
        }

        document.querySelector('.close').onclick = function() {
            document.getElementById('resultModal').style.display = "none";
        };

        window.onclick = function(event) {
            if (event.target == document.getElementById('resultModal')) {
                document.getElementById('resultModal').style.display = "none";
            }
        };
    </script>
</body>
</html>
